# Micro-Python Test Framework Package
The project to implement a micro-python based framework and library that provides a set of convenient abstractions designed to remove as much boilerplate as possible from firmware test setup, case development and execution. The framework aspires to do so in a lightweight and minimalistic fashion. It is general enough to be useful in a variety of firmware testing scenarios. It is a generic testing framework for black box tests, white box tests, functional test, automate UI / human interaction.

## How to build
The Test Framework is dependent on the MicroPythonPkg, so before any further step, please build MicroPythonPkg following README.md under that folder. 

### Download Required Tools
 * Install [Python27](https://www.python.org/) to run python tool from source, set environment variable *PYTHON_HOME* as Python27 installation directory
 * Install Maven following offical site tutorial [Installing Apache Maven](https://maven.apache.org/install.html)
 * Download Chart.bundle.min.js from [ChartJS official site](https://github.com/chartjs/Chart.js/releases) to ```MpyTestFrameworkPkg\Report\resources\js```
 * Download jquery-3.3.1.js from  [JQuery official site](https://jquery.com/download/) to ```MpyTestFrameworkPkg\Report\resources\js```
 
### Compile
Change directory to edk2 code base, execute command below(suppose the edk2 code base is ```C:\edk2```):
 
 ```
 C:\edk2> edksetup.bat
 C:\edk2> python setup.py VS2013 DEBUG
 ```
 For setup.py, the first parameter is in ```['VS2013', 'VS2015', 'VS2017']``` and the second parameter is in ```['DEBUG', 'RELEASE', 'NOOPT']```.
 The executable target will be generated at ```edk2_repo/Build/MpyTest```

## Setup 

It allows the UEFI validator design the test cases and scripts with python language in UEFI environment. The procedure to set up the Micro-Python Test Framework is below. 
 * Copy the generated ```MpyTest``` directory and its content into a media disk at root level
 * Create the test scripts under `Scripts` folder.
 * Mount the media disk into the SUT (System Under Test) and boot the SUT into the UEFI shell.
 * Rename the lable of midia disk to "MPTF" with command below:
     ```
    vol -n MPTF
    ```
 * Enter the directory of Micro-Python Test Framework and use Startup.nsh with parameters to launch it. 
  
 ### File structure
 Under the directory of Micro-Python Test Framework, there are several sub-folders and files.
 * Bin
MicroPython for UEFI generated by MicroPythonPkg
* Config
Under `Config` folder, there two json format files which can determine suquence of test case including running order and runnning times. For the test case, we have three kinds of concept: case, suite and suites. Case represents independent test sripts under Sripts folder which will be mentioned later.
Suite is a sequence of cases which can be defined through Test_Suite.json file. Similarly, Suites is a sequence of suite which can be defined through Test_Suites.json file.
* Doc
The Script Writting Guide for built-in API introduction.
* Lib
Task schduler, built-in API and python wrapper for UEFI service.
* Log
The log of test case will be put here
* Tools
Provides a series of practical tools. For example, the tool to parse log to human friendly report. The usage is
``` 
    java -jar ReportGenerator-1.0-SNAPSHOT-jar-with-dependencies.jar
```
* Report
Generated report and resources will be put here

* Scripts
Some sample test cases are in `Scripts` folder by default. What'more, all the test cases created need to be put under this folder. To modify and execute the sample script is a good method to get familiar with this framework and scripts.
* startup.nsh
 The `startup.nsh` is the entry to launch the framework, the usage is as below:  
 ```
    Startup.nsh [-h] [-a [ia32 | x64] [-d] [-t [script name]] [-s [sequence name]] ]
        -h   Help info 
        -a   Load binary for ia32 platform or x64 platform. Besides -h, -a should be first parameter
        -c   Run a Test Case in Script folder
        -s   Run a Test Suite which has a sequence of Test Cases
        -ss  Run a sequences of Test Suite 
        Note: Please specify the platform before other settings
 ```
 ### Get Started on Nt32
 * Please build Nt32 following links from [EDK II](https://github.com/tianocore/tianocore.githubio/wiki/Getting-Started-with-EDK-II) to built NT32.

 * Copy `%WORKSPACE%\Build\MpyTest` to the same directory as `SecMain.exe`.
 * Double click `SecMain.exe` to run Nt32.
 * After enter shell enviroment, type command below to change volumn lable. 
    ```
     fS0:
     vol -n MPTF
    ```
 * Enter `MpyTest` directory to run the test case provided by default. Use command below to run test case, suite or suites.
      * Run the test case `nt32_shell_hii.py` alone:
      ```
       startup.nsh -a ia32 -c nt32_shell_hii.py
      ```
      * Run the test suite `nt32_test_cases` which is defined in `Test_Suite.json` under `Config` folder:
     ```
      startup.nsh -a ia32 -s nt32_test_cases
     ```
      * Run the test suites `nt32_related_suites` which is defined in `Test_Suites.json` under `Config` folder:
     ```
      startup.nsh -a ia32 -ss nt32_related_suites
     ```
 * Check the log and generate report. The log will be put under `Log` folder automaticlly, change to `Tools` folder and use command below to generate report.
    ```
       java -jar ReportGenerator-1.0-SNAPSHOT-jar-with-dependencies.jar
    ```
 * Change to `Report` folder to check the report generated.
